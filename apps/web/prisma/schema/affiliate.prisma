model Affiliate {
  id          String   @id @default(cuid())
  projectId   String
  email       String
  firstName   String?
  lastName    String?
  phoneNumber String?
  countryCode String?
  externalId  String?
  linkId      String?  @unique
  dotsUserId  String?  @unique
  dotsStatus  String?
  dotsFlowId  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  link    Link?   @relation(fields: [linkId], references: [id], onDelete: SetNull)

  @@unique([projectId, email])
  @@unique([projectId, externalId])
  @@index([projectId])
  @@index([externalId])
}

model Payout {
  id           String   @id @default(cuid())
  affiliateId  String
  amount       Int
  currency     String
  currencyRate String
  status       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  referrals Referral[]
}

model Referral {
  id           String   @id @default(cuid())
  payoutId     String?
  clickId      String
  amount       Int
  currency     String
  currencyRate String
  status       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  payout Payout? @relation(fields: [payoutId], references: [id], onDelete: Cascade)

  @@index([payoutId])
}
